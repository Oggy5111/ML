import pandas as pd
from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans
import matplotlib.pyplot as plt

# 1. Load dataset
df = pd.read_csv("sales_data_sample.csv", encoding="ISO-8859-1")

# Keep only numeric features
num_df = df.select_dtypes(include=['int64', 'float64']).dropna()

# Scale the data
scaler = StandardScaler()
scaled = scaler.fit_transform(num_df)

# 2. Elbow Method to find optimal K
wcss = []
for k in range(1, 11):
    km = KMeans(n_clusters=k, random_state=42)
    km.fit(scaled)
    wcss.append(km.inertia_)

plt.plot(range(1, 11), wcss, marker='o')
plt.xlabel("Number of Clusters (k)")
plt.ylabel("WCSS")
plt.title("Elbow Method")
plt.show()

# 3. Final K-Means Model (choose your k based on elbow)
k = 3   # example
kmeans = KMeans(n_clusters=k, random_state=42)
clusters = kmeans.fit_predict(scaled)

# Add cluster labels to dataset
df["Cluster"] = clusters
print(df[["Cluster"]].head())
